<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualizador de Plano de Ensino</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">

    <style>
        body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
            padding: 45px;
        }

        @media (max-width: 767px) {
            body {
                padding: 15px;
            }
        }

        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 980px;
            margin: 0 auto;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>

<body>
    <div id="output" class="markdown-body">Carregando planejamento...</div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const arquivoMD = urlParams.get('p');
    const output = document.getElementById('output');

    if (arquivoMD) {
        // Criamos o caminho absoluto baseado na URL atual para não ter erro de pasta
        const pastaPlanejamentos = window.location.pathname.replace('view-planejamento.html', 'planejamentos/');
        const urlFinal = `${window.location.origin}${pastaPlanejamentos}${arquivoMD}`;

        console.log("Tentando buscar em:", urlFinal); // Debug no F12

        fetch(urlFinal)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Arquivo não encontrado (Erro ${response.status})`);
                }
                return response.text();
            })
            .then(text => {
                output.innerHTML = marked.parse(text);
                document.title = `Plano: ${arquivoMD}`;
            })
            .catch(error => {
                output.innerHTML = `
                    <div style="background:#fff5f5; color:#c53030; padding:20px; border-radius:8px; border:1px solid #feb2b2; font-family:sans-serif">
                        <h3>Erro de Carregamento</h3>
                        <p>Não foi possível encontrar o arquivo: <strong>${arquivoMD}</strong></p>
                        <p style="font-size: 0.8em">Caminho tentado: <code style="word-break: break-all;">${urlFinal}</code></p>
                        <button onclick="location.reload(true)" style="margin-top:10px; cursor:pointer">Tentar Recarregar (Limpar Cache)</button>
                    </div>`;
            });
    } else {
        output.innerHTML = "<h3>Aguardando parâmetro...</h3><p>Use ?p=nome-do-arquivo.md na URL.</p>";
    }
</script>
</body>

</html>